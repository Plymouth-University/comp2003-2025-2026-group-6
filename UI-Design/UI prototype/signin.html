<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign In â€“ Capture the Flag</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div class="tabs" aria-hidden="true">
        <span></span><span></span><span></span><span></span>
      </div>
      <div class="windowBtns" aria-hidden="true">
        <i></i><i></i><i></i>
      </div>
    </header>

    <main class="screen">
      <section class="welcomeCard">
        <h2 style="margin-top:0; font-size:32px; font-weight:900;">
          Sign In
        </h2>

        <form id="signinForm">
            <p class="welcomeText">Create your account</p>
            
            <input
            type="email"
            id="email"
            placeholder="Email address"
            required
            style="font-size:18px; padding:10px; border:4px solid #000; width:100%; max-width:300px; margin:10px auto; display:block;"
            />
            
            <input
            type="password"
            id="password"
            placeholder="Password"
            required
            style="font-size:18px; padding:10px; border:4px solid #000; width:100%; max-width:300px; margin:10px auto; display:block;"
            />
            
            <input
            type="text"
            id="playerName"
            placeholder="Player name (display name)"
            required
            style="font-size:18px; padding:10px; border:4px solid #000; width:100%; max-width:300px; margin:10px auto; display:block;"
            />
            
            <button class="startBig" type="submit">
                Sign Up & Enter Game
            </button>
        </form>

        <p style="margin-top: 24px; font-size: 16px; color: #333;">
          Already have an account? 
          <a href="login.html" style="color: #6c2bd9; font-weight: bold; text-decoration: underline;">Log in</a>
        </p>
      </section>
    </main>
  </div>

  <!-- Firebase SDK - latest modular version via CDN -->
<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAYQeZzdYUqKYiiwcpFp8BNZQsJNHtoMXo",
    authDomain: "ctf-game-06.firebaseapp.com",
    projectId: "ctf-game-06",
    storageBucket: "ctf-game-06.firebasestorage.app",
    messagingSenderId: "509318018925",
    appId: "1:509318018925:web:a91ddc9f7fc130dfe54c64",
    measurementId: "G-L4WP0E0V6S"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Handle form submission (signup)
  document.getElementById("signinForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const playerName = document.getElementById("playerName").value.trim();

    if (!email || !password || !playerName) {
      alert("Please fill all fields!");
      return;
    }

    try {
      // Create user with email/password
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      console.log("User signed up:", user.uid);

      // Save player name (and optionally user ID) to localStorage
      localStorage.setItem("playerName", playerName);
      localStorage.setItem("userEmail", user.email); // optional

      // Redirect to next page
      window.location.href = "join.html";
    } catch (error) {
      // Show friendly error messages
      let msg = "Signup failed. Please try again.";
      if (error.code === "auth/email-already-in-use") {
        msg = "This email is already in use. Try logging in instead.";
      } else if (error.code === "auth/weak-password") {
        msg = "Password is too weak. Use at least 6 characters.";
      } else if (error.code === "auth/invalid-email") {
        msg = "Invalid email format.";
      }
      alert(msg);
      console.error(error);
    }
  });
</script>

  <script>
    document.getElementById("signinForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const name = document.getElementById("playerName").value.trim();
      if (!name) return;

      localStorage.setItem("playerName", name);
      window.location.href = "join.html";
    });
  </script>
</body>
</html>
